function showRoll(id){Swal.fire({title:"<strong>Roll No:."+id+"</strong>",type:"info",html:'You can use <b>bold text</b>, <a href="//sweetalert2.github.io">links</a> and other HTML tags',showCloseButton:!0,showCancelButton:!0,focusConfirm:!1,confirmButtonText:'<i class="fa fa-thumbs-up"></i> Great!',confirmButtonAriaLabel:"Thumbs up, great!",cancelButtonText:'<i class="fa fa-thumbs-down"></i>',cancelButtonAriaLabel:"Thumbs down"})}!function($){$("#colorselect").on("change",(function(){let color=JSON.parse(this.value),html="",oqty=0;$.each(color,(function(indexInArray,valueOfElement){html+="<option value="+valueOfElement+">"+indexInArray+"</option>",oqty+=parseInt(valueOfElement)})),$("#size").append(html),$("#sizer").show(),$("#oqty").html(oqty),$("#oqtyf").val(oqty),$("#colorf").val($("#colorselect>option:selected").text())})),$("#size").on("change",(function(){let value=this.value;$("#qtyv").html(value),$("#iqtyf").val(value),$("#sizef").val($("#size>option:selected").text()),$("#qtyr").show(),$("#formsubmit").show()})),$("#rqty").on("input",(function(e){let errorhtml='<div class="pt-1"> <div class="alert alert-danger alert-dismissible bg-danger text-white border-0 fade show" role="alert"> <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> Possible value exceeded </div></div>',rqty,iqty;parseInt(this.value)>parseInt($("#iqtyf").val())||!$.isNumeric($(this).val())?($("#errorbox").html(errorhtml),$(this).val("")):$("#errorbox").html("")}))}(jQuery),function($){function hasMatch(JSON,key,value){for(var hasMatch=!1,index=0;index<JSON.length;++index){var line;if(JSON[index][key]==value){hasMatch=!0;break}}return hasMatch}function addNewPO(po,count){$("#preloader").delay(350).fadeIn("slow"),$("#status").fadeIn();for(let index in po){var dfrd1=$.Deferred();$.ajax({type:"post",url:"/addNewPO",data:{po:po[index]},success:function(response){console.log("Success! "+response),po.length-1==index&&(console.log("Resolving!"),dfrd1.resolve(),$("#status").fadeOut(),$("#preloader").delay(350).fadeOut("slow")),count++},error:function(error){console.error(error)}})}return dfrd1.promise()}$("#AddMatNB").on("change",(function(e){var ext=$("#AddMatNB").val().split(".").pop().toLowerCase();if(-1==$.inArray(ext,["csv"]))return Swal.fire("Import Process Canceled","Proccess canceled due to a detected file error. You may try again!","info"),!1;if(null!=e.target.files){var reader=new FileReader;reader.onload=function(e){csvResult=$.csv.toObjects(e.target.result),Swal.fire({title:csvResult.length+" Rolls detected, Ready to finish adding?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, add as New Purchase Orders!"}).then(result=>{result.value?($("#preloader").delay(350).fadeIn("slow"),$("#status").fadeIn(),csvResult.forEach((function(row,i){$.ajax({type:"post",url:"/addNewPO",data:{roll:row},success:function(response){console.log("Success! "+response),po.length-1==index&&(console.log("Resolving!"),dfrd1.resolve(),$("#status").fadeOut(),$("#preloader").delay(350).fadeOut("slow")),count++},error:function(error){console.error(error)}}),console.log(row),csvResult.length-1==i&&(console.log("Resolving!"),$("#status").fadeOut(),$("#preloader").delay(350).fadeOut("slow"))})),Swal.fire("Added Successfully!","This page will be refreshed.","success").then(()=>{window.location.reload()})):window.location.reload()})},reader.readAsText(e.target.files.item(0))}})),$("#AddPONB").on("change",(function(e){var data={PO:[]},ext=$("#AddPONB").val().split(".").pop().toLowerCase();if(-1==$.inArray(ext,["csv"]))return Swal.fire("Import Process Canceled","Proccess canceled due to a detected file error. You may try again!","info"),!1;if(null!=e.target.files){var reader=new FileReader;reader.onload=function(e){csvResult=$.csv.toObjects(e.target.result),csvResult.forEach((function(row,i){var ponoCSV=row.CustomerPONumber,colorNameCSV=row.color,sizeNameCSV=row.size,CutQtyCSV=Math.round(row.CutQty).toString(),Qty=parseInt(row.Qty);if(0!=data.PO.length){for(let index in data.PO)if(data.PO[index].PONO===ponoCSV)if(data.PO[index].Color.hasOwnProperty(row.color))data.PO[index].Color[colorNameCSV][sizeNameCSV]=CutQtyCSV,data.PO[index].Qty=parseInt(data.PO[index].Qty)+Qty;else{let color=JSON.parse('{"'+colorNameCSV+'": {"'+sizeNameCSV+'":"'+CutQtyCSV+'"}}');$.extend(data.PO[index].Color,color),data.PO[index].Qty=parseInt(data.PO[index].Qty)+Qty}else if(!hasMatch(data.PO,"PONO",ponoCSV)){let ponew2={PONO:row.CustomerPONumber,Customer:row.customer,Style:row.StyleNumber,Qty:row.Qty,Product:row.product,Color:{}},color=JSON.parse('{"'+colorNameCSV+'": {"'+sizeNameCSV+'":"'+CutQtyCSV+'"}}');ponew2.Color=color,data.PO.push(ponew2)}}else{let ponew1={PONO:row.CustomerPONumber,Customer:row.customer,Style:row.StyleNumber,Qty:row.Qty,Product:row.product,Color:{}},color=JSON.parse('{"'+colorNameCSV+'": {"'+sizeNameCSV+'":"'+CutQtyCSV+'"}}');ponew1.Color=color,data.PO.push(ponew1)}}));var count=data.PO.length;Swal.fire({title:count+" Purchase Orders detected, Ready to finish adding?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, add as New Purchase Orders!"}).then(result=>{result.value?addNewPO(data.PO,0).done((function(){Swal.fire("Added Successfully!","This page will be refreshed.","success").then(()=>{window.location.reload()})})):window.location.reload()})},reader.readAsText(e.target.files.item(0))}}))}(jQuery),function($){$("#addWF").on("click",(function(e){Swal.mixin({input:"text",confirmButtonText:"Next &rarr;",showCancelButton:!0}).queue(["Enter Shrinkage"]).then(result=>{if(result.value){$(":button").prop("disabled",!0);let dt=result.value;if(null!=dt)try{dt.forEach(element=>{if(!$.isNumeric(element))throw new Error("Invalid Value: "+element)});let form=new FormData;form.append("poid",$("#poid").val()),form.append("s",dt[0]),$.ajax({type:"post",url:"/addWF",data:form,processData:!1,contentType:!1,success:function(response){$(":button").prop("disabled",!1),Swal.fire({type:"success",title:"Waterfall No: "+response+" is created.",html:'<form action="/buildWF" method="post"><input type="hidden" name="id" value="'+response+'"><button class="btn btn-success" type="submit" ><i class="mdi mdi-shopping mr-2 text-white  font-18 vertical-middle"></i>Add Sequence</button ></form >',confirmButtonText:"Skip"}).then(()=>{})},error:function(request,status,error){$(":button").prop("disabled",!1),Swal.fire({type:"error",title:"Oops...",html:"<pre><code> Something went wrong! "+request.responseText+"</code></pre>"})}})}catch(error){$(":button").prop("disabled",!1),Swal.fire({type:"error",title:"Oops...",text:"Something went wrong! "+error})}}}),$(":button").prop("disabled",!1)}))}(jQuery),function($){function addRollWF(e){text=e,Swal.mixin({input:"text",confirmButtonText:"Next &rarr;",text:text,showCancelButton:!0}).queue(["Enter/ Scan Roll No"]).then(result=>{if(result.value){$(":button").prop("disabled",!0);let dt=result.value;if(null!=dt)try{let form=new FormData;form.append("wfid",$("#wfid").val()),form.append("roid",dt[0]),$.ajax({type:"post",url:"/addRollWF",data:form,processData:!1,contentType:!1,success:function(response){$(":button").prop("disabled",!1),addRollWF(response)},error:function(request,status,error){$(":button").prop("disabled",!1),Swal.fire({type:"error",title:"Oops...",html:"<pre><code> Something went wrong! "+request.responseText+"</code></pre>"})}})}catch(error){$(":button").prop("disabled",!1),Swal.fire({type:"error",title:"Oops...",text:"Something went wrong! "+error})}}}),$(":button").prop("disabled",!1)}$("#addRollWF").on("click",(function(e){addRollWF("Scan Ready")}))}(jQuery);